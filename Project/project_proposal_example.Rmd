
---
title: "SDS/MTH 220 Project Proposal Example"
author: "Jenny Smetzer & Albert Y. Kim"
date: "Last updated on `r Sys.Date()`"
output:
  html_document:
    fig_caption: yes
    theme: lumen
    toc: yes
    toc_depth: 2
    df_print: kable
    toc_float:
      collapsed: no
---

```{r, message=FALSE}
# Load all packages here:
library(readr)
library(dplyr)
library(ggplot2)
library(janitor)

# Set seed value of random number generator to get "replicable" random numbers.
# The choice of seed value of 76 was an arbitrary one on my part.
set.seed(76)
```


# Data

## Load data into R

_Include the code to load your data here. If your data is not confidential nor is it private in nature, consider publishing it as a `.csv` file on Google Sheets as in the code chunk below; instructions on how to do this are in Steps 1-6 [here](https://twitter.com/rudeboybert/status/1055821846539591680). If the data shouldn't be published online, then please submit the spreadsheet file on Moodle._

```{r, message=FALSE}
ma_schools <- read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vSrWSNyNqRVA950sdYa1QazAT-l0T7dl6pE5Ewvt7LkSm9LXmeVNbCbqEcrbygFmFyK4B6VQQGebuk9/pub?gid=1469057204&single=true&output=csv")
```

## Clean variable names

_Piping your data frame into the `clean_names()` function from the `janitor` package will clean your variable names, making them easier to work with._

```{r}
ma_schools <- ma_schools %>% 
  clean_names()
```

## Data wrangling

Complete your data wrangling here: 

```{r}
# This converts the numerical variable total_enrollment into a categorical one
# school_size by cutting it into three chunks:
ma_schools <- ma_schools %>% 
 mutate(school_size = cut_number(total_enrollment, n=3))

# For aesthetic purposes we changed the levels of the school_size variable to be
# small, medium, and large
ma_schools <- ma_schools %>%
  mutate(school_size = recode_factor(school_size, "[0,341]" = "Small", "(341,541]" = "Medium", "(541,4.26e+03]" = "Large"))

# Next we filtered to only include schools that had 11th and 12th grade students
ma_schools <- ma_schools %>%
  filter(x11_enrollment > 0 & x12_enrollment > 0)
```



***


# Preview of data

## Pare down variables

_`select()` the following variables **in this order** and drop all others. Eliminating all unnecessary variables will making visually exploring the raw values less taxing mentally, as we'll have less data to look at._

1. _The identification variable_
1. _The outcome variable $y$_
1. _The numerical explanatory variable_
1. _The categorical explanatory variable_
1. _Optional: any other variable you find interesting_

Recall that we didn't find a categorical variable to our liking in the original `ma_schools` data. So eventually we'll create a categorical explanatory variable `school_size` with three levels: `small`, `medium`, `large` based on the values of `total_enrollment`. We will do this in the next step of the project once we are more experienced with data wrangling.

```{r}
ma_schools <- ma_schools %>% 
  select(school_name, average_sat_math, percent_economically_disadvantaged, school_size)
```

## Explore your data

_Be sure to explore your data. Note that `eval=FALSE` is set so that R Markdown doesn't "evaluate" this code chunk, i.e. it will ignore it in the ultimate `.html` report. You should run this code on your own, but not in the ultimate `.html` report._

```{r, eval = FALSE}
glimpse(ma_schools)
```

## Preview data

_Display a random sample of 5 rows of your data frame by piping it into the `sample_n(5)` function from the `dplyr` package . You'll get the same 5 rows everytime you knit this document and hence replicable results because we set the seed value of the random number generator in the first code chunk above._

We see we have missing values below. Some of these are missing because some of the schools are not high schools so the students don't take the Math SAT. We will address these missing values in the next step of the project once we are more experienced with data wrangling.

```{r}
ma_schools %>% 
  sample_n(5)
```



***



# Exploratory data analysis

## Inspect for NA values

```{r}
colSums(is.na(ma_schools))
```

## Summary statistics of outcome variable

```{r}
ma_schools %>% 
  group_by(school_size) %>% 
  summarize(n = n(), 
            mean = mean(average_sat_math, na.rm = TRUE), 
            median = median(average_sat_math, na.rm = TRUE), 
            sd = sd(average_sat_math, na.rm = TRUE), 
            min = min(average_sat_math, na.rm = TRUE), 
            max = max(average_sat_math, na.rm = TRUE))
```


## Histogram of outcome variable 

```{r, fig.cap = "Figure 1. Distribution of average Math SAT scores in the State of Massachusetts in 2017", fig.align = "center"}
ggplot(ma_schools, aes(x = average_sat_math)) +
  geom_histogram(binwidth = 30, color = "white", fill = "steelblue") +
  labs(x = "Average Math SAT Score", y = "Number of Schools with the Score") 
```

These data look normally distributed, with no obvious skew. There might be an outlier ~ 750 or so. 

## Scatterplot - outcome variable against numeric variable

```{r, fig.cap = "Figure 2. Scatterplot illustrating the relationship between Percentage of Economically Disadvantaged Students and Math SAT Score in MA Schools in 2017", fig.align = "center"}

ggplot(ma_schools, aes(x = percent_economically_disadvantaged, y = average_sat_math))+
  geom_point() +
  geom_smooth(method = "lm", se = FALSE ) +
  labs(y = "Math SAT Score", x = "Percentage of Economically Disadvantaged Students")
```

There appears to be a reasonably strong negative relationship between percent of economically disadvanted students and Math SAT scores. When a school has more disadvantaged students, Math SAT scores tend to be lower. 

## Boxplot - outcome variable by categorical variable

```{r, fig.cap = "Figure 3. Boxplot showing Math SAT score for each school size category", fig.align = "center"}
ggplot(ma_schools, aes(x = school_size, y = average_sat_math)) +
  geom_boxplot(fill = c("sienna", "darkgreen", "steelblue")) +
  labs(y = "Math SAT Score", x = "School Size")
```

The Math SAT scores look to be the greatest at larger schools, and the lowest at smaller schools, though the difference does not seem to be extreme. There appear to be some potential outliers in SAT scores. In particular, there is one small school with a very high average SAT score.   

## Scatterplot- outcome variable against both predictors

```{r, fig.cap = "Figure 4. Scatterplot illustrating the relationship between Percentage of Economically Disadvantaged Students and Math SAT Score in MA Schools of different sizes in 2017", fig.align = "center"}
ggplot(ma_schools, aes(x = percent_economically_disadvantaged, y = average_sat_math, color = school_size))+
  geom_point() +
  geom_smooth(method = "lm", se = FALSE ) +
  labs(y = "Math SAT Score", x = "Percentage of Economically Disadvantaged Students")
```

A negative relationship between percent of economically disdvantaged students is evident for each of the different size of schools. The slopes of the lines representing each size of school appear to be fairly similar. There does not appear to be an interaction between the two explanatory variables. 