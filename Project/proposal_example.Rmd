---
title: "Proposal: Part I"
author: "Albert & Jenny"
date: "January 2019"
output:
  html_document:
    fig_caption: yes
    theme: lumen
    toc: yes
    toc_depth: 2
    df_print: kable
    toc_float:
      collapsed: no
---

```{r, include=FALSE}
# Do not edit this code block/chunk
knitr::opts_chunk$set(message=FALSE, warning = FALSE, fig.width = 16/2, fig.height = 9/2)
```

# 1. Load all necessary packages 
```{r}
library(ggplot2)
library(dplyr)
library(janitor)
library(moderndive)
library(readr)
library(tidyr)
library(knitr)
```

***

# 2. Import and glimpse the data 
```{r message = F}
ma_schools <- read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vSrWSNyNqRVA950sdYa1QazAT-l0T7dl6pE5Ewvt7LkSm9LXmeVNbCbqEcrbygFmFyK4B6VQQGebuk9/pub?gid=1469057204&single=true&output=csv")

```

```{r message = F, eval= F}
glimpse(ma_schools)
```

***

# 3. Clean/wrangle the data 

The steps will be a different for each project, but the basic elements include: 

* Making sure it is in Tidy format
* Selecting only the variables you'll be using in the following order:

a) (If any are included) identification variables
b) The numerical outcome variable y
c) The numerical explanatory variable x1
d) The categorical explanatory variable x2

You may need to transform variables, reclassify, filter, etc. See the R Ninja formatting file for help. 

```{r}
# This selects fewer variables for now, to make the "wrangling" easier

ma_schools_tidy <- ma_schools %>%
  select("School Name",
         "11_Enrollment",
         "12_Enrollment",
         "TOTAL_Enrollment",
         "Economically Disadvantaged",
         "% Economically Disadvantaged",
         contains("SAT"))
```


```{r}
# This cleans up the names

ma_schools_tidy<- ma_schools_tidy %>% 
  clean_names()  
```


```{r}
# This makes a categorical variable, school_size, by cutting total enrollment into three chunks

ma_schools_tidy <- ma_schools_tidy %>% 
 mutate(school_size = cut_number(total_enrollment, n=3)) 
```


```{r}
# Next we filtered to only include schools that had 11th and 12th grade students

ma_schools_tidy <-ma_schools_tidy %>%
  filter(x11_enrollment > 0 
         & x12_enrollment > 0)
```


```{r}
# For aesthetic purposes we changed the school size category names to Small, Medium, and Large

ma_schools_tidy <-ma_schools_tidy %>%
  mutate(size = recode_factor(school_size, "[0,341]" = "Small",
                              "(341,541]" = "Medium",
                              .default = "Large"))
```


```{r}
# Here we select our identification, outcome, and explanatory variables
high_schools_data <- ma_schools_tidy %>%
  select("school_name", contains("sat"), "percent_economically_disadvantaged", "size")
```

```{r}
# We gathered the three SAT test columns into rows, under the column name "sat_type" and "score"
high_schools_data_sat <-  gather(high_schools_data, "sat_type", "score", 3:5)%>%
  filter(sat_type == "average_sat_math")
```

## 3.a. Print a slice of cleaned data 

```{r}
# Here is the final, cleaned, tidy data set with the ID variable, oucome variable,  numeric x, categorical x

high_schools_data_sat <- high_schools_data_sat %>% 
  select(school_name, score, percent_economically_disadvantaged, size)

high_schools_data_sat %>% slice(1:5)
```

## 3.b. Glimpse cleaned data 
Make sure the outcome variable is numeric, one explanatory variable is numeric, and another is either a character <chr> or a factor <fct>. 

```{r}
glimpse(high_schools_data_sat)
```

***

# 4. Exploratory analysis 

## 4.a. Inspect for NA values
```{r}
colSums(is.na(high_schools_data_sat))
```

## 4.b. Summary statistics outcome variable
```{r}
high_schools_data_sat %>% 
  group_by(size) %>% 
  summarize(n = n(), 
            xbar = mean(score, na.rm = T), 
            Mdn = median(score, na.rm = T), 
            sd = sd(score, na.rm = T), 
            min = min(score, na.rm = T), 
            max = max(score, na.rm = T)) %>% 
  kable(digits = 2)
            
```

*** 

# 5. Data Visualization 

## 5.a. Histogram- outcome variable 
```{r, fig.cap = "Figure 1. Distribution of average Math SAT scores in the State of Massachusetts in 2017", fig.align = "center"}

ggplot(high_schools_data_sat, aes(x = score)) +
  geom_histogram(binwidth = 30, color = "white", fill = "steelblue") +
  labs(x = "Average Math SAT Score", y = "Number of Schools with the Score") 
```

These data look normally distributed, with no obvious skew. There might be an outlier ~ 750 or so. 

## 5.b. Scatterplot- outcome variable against numeric variable

```{r, fig.cap = "Figure 2. Scatterplot illustrating the relationship between Percentage of Economically Disadvantaged Students and Math SAT Score in MA Schools in 2017", fig.align = "center"}

ggplot(high_schools_data_sat, aes(x = percent_economically_disadvantaged, y = score))+
  geom_point() +
  geom_smooth(method = "lm", se = FALSE ) +
  labs(y = "Math SAT Score", x = "Percentage of Economically Disadvantaged Students")
```

There appears to be a reasonably strong negative relationship between percent of economically disadvanted students and Math SAT scores. When a school has more disadvantaged students, Math SAT scores tend to be lower. 

## 5.c. Boxplot- outcome variable by categorical variable

```{r, fig.cap = "Figure 3. Boxplot showing Math SAT score for each school size category", fig.align = "center"}

ggplot(high_schools_data_sat, aes(x = size, y = score)) +
  geom_boxplot(fill = c("sienna", "darkgreen", "steelblue")) +
  labs(y = "Math SAT Score", x = "School Size")
```

The Math SAT scores look to be the greatest at larger schools, and the lowest at smaller schools, though the difference does not seem to be extreme. There appear to be some potential outliers in SAT scores. In particular, there is one small school with a very high average SAT score.   

## 5.d. Scatterplot- outcome variable against both predictors

```{r, fig.cap = "Figure 4. Scatterplot illustrating the relationship between Percentage of Economically Disadvantaged Students and Math SAT Score in MA Schools of different sizes in 2017", fig.align = "center"}

ggplot(high_schools_data_sat, aes(x = percent_economically_disadvantaged, y = score, color = size))+
  geom_point() +
  geom_smooth(method = "lm", se = FALSE ) +
  labs(y = "Math SAT Score", x = "Percentage of Economically Disadvantaged Students")
```

A negative relationship between percent of economically disdvantaged students is evident for each of the different size of schools. The slopes of the lines representing each size of school appear to be fairly similar. There does not appear to be an interaction between the two explanatory variables. 